---
import SunIcon from "../icons/Sun.astro";
import MoonIcon from "../icons/Moon.astro";
---

<div class="relative ml-1 mr-1">
  <button
    transition:persist
    id="themeToggleBtn"
    class="appearance-none border-none flex hover:scale-125 transition"
  >
    <span class="sr-only">Choose theme</span>
    <SunIcon id="light" class="themeToggleIcon size-5 transition-all" />
    <MoonIcon
      id="dark"
      class="themeToggleIcon absolute size-5 transition-all"
    />
  </button>
</div>

<script is:inline>
  const updateThemeIcon = (theme) => {
    document.querySelectorAll(".themeToggleIcon").forEach((element) => {
      element.style.scale = element.id === theme ? "1" : "0";
    });
  };

  // Initialize icon based on current class (set by Layout.astro)
  const isDarkInitial = document.documentElement.classList.contains("dark");
  updateThemeIcon(isDarkInitial ? "dark" : "light");

  const handleThemeToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    updateThemeIcon(isDark ? "dark" : "light");
    localStorage.setItem("theme", isDark ? "dark" : "light");

    // Update theme-color meta tag
    const meta = document.getElementById("theme-color-meta");
    if (meta) {
      meta.content = isDark ? "#030712" : "#f9fafb";
    }
  };

  document
    .getElementById("themeToggleBtn")
    ?.addEventListener("click", handleThemeToggleClick);
</script>
